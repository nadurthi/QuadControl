#include "kinematic_estimators.h"
#include<cmath>



/*
 * Queue class functions: These functions are written such that they are more useful only for this project
 */
void SimpleQueue::AppendQ(double *D,int *C){
	for(int c=0;c<columns;c++){
		for(int r=0;r<rows;r++){
			if(r<rows-1){
				a[r][c]=a[r+1][c]; }
			else{
				a[rows-1][c]=D[ C[c] ];}
		}
	}

}
void SimpleQueue::MeanQ( int r1, int r2) {
	  if(CheckSizeQ(r1,0)+CheckSizeQ(r2,0)<2)
		  exit(1);

	   int r,c;
	   double D;
	   for(c=0;c<columns;c++){
		   D=0;
		   for(r=r1;r<=r2;r++){
			   D=D+a[r][c];
		   }
		   mu[c]=D/(r2-r1+1);
	   }
}

void SimpleQueue::StdQ(int r1, int r2){
	if(CheckSizeQ(r1,0)+CheckSizeQ(r2,0)<2)
			  exit(1);

	int r,c;
	double D;
	MeanQ(r1, r2);
	for(c=0;c<columns;c++){
			   D=0;
			   for(r=r1;r<=r2;r++){
				   D=D+pow(a[r][c]-mu[c],2);
			   }
			   D=sqrt(D/(r2-r1+1));

			   if(D>maxstdev[c])
				   maxstdev[c]=D;

			   stdev[c]=D;
		   }
}

double * SimpleQueue::GetRowQ(int r,double *D){
	if(CheckSizeQ(r,0)<1)
			  exit(1);

	for(int i;i<columns;i++){
		D[i]=a[r][i];
	}

	return D;
}

double * SimpleQueue::GetColQ(int c,double *D){
	if(CheckSizeQ(0,c)<1)
			  exit(1);

	for(int i;i<rows;i++){
		D[i]=a[i][c];
	}

	return D;
}

double * SimpleQueue::GetLastRowQ(double *D){
	for(int i;i<columns;i++){
		D[i]=a[rows-1][i];
	}
	return D;
}
void SimpleQueue::ReplaceRowQ(int r,double *D){
	if(CheckSizeQ(r,0)<1)
			  exit(1);

	for(int c=0;c<columns;c++){
	a[r][c]=D[c];
	}
}
void SimpleQueue::ReplaceLastRowQ(double *D){
	for(int c=0;c<columns;c++){
	a[rows-1][c]=D[c];
	}
}
void SimpleQueue::AvgOutlierFilterQ(){

	//outlier remover and averager
	StdQ(0, rows-2);//mu for N-1 rows is evalauted here already
    for(int c=0;c<columns;c++){
    	if(abs(mu[c]-a[rows-1][c])>5*(0.5*maxstdev[c]+0.5*stdev[c])){
    		a[rows-1][c]=mu[c];
    	}
    	else{
    		a[rows-1][c]=((rows-1)*mu[c]+a[rows-1][c])/(rows); //movign average. mu was calculated above for N-1 rows (N total rows)
    	}

    }



}






//write all
void Condition_latest_data_Algo1(QuadStateVariable * data){
	//checking if received parameter data Fd,ba,bg,rmis,qmis make sense
	if(data->Fd){	}

//remove outliers for queues
	//only the queues for the measurements
    //assumpiton: the last value in the queue is the latest raw data. This will be replaced by a outlier/averager filtered data. The raw data queue
	// is not altered
	//first compute the standard deviation of the current data set


	}

